; ============================================================
;  MimiClaw / AtomClaw - PlatformIO Configuration
;  Framework: ESP-IDF
;
;  Build:
;    MimiClaw (AtomS3R / StickS3 16MB):  pio run -e mimiclaw
;    AtomClaw (AtomS3R / StickS3  8MB):  pio run -e atomclaw
;
;  Flash:
;    pio run -e atomclaw -t upload
;
;  Serial monitor:
;    pio device monitor -e atomclaw
; ============================================================

[platformio]
default_envs = atomclaw
src_dir = main

; ── Shared base ─────────────────────────────────────────────

[env:base]
platform  = espressif32
framework = espidf

; Common build flags
build_flags =
    -DCORE_DEBUG_LEVEL=3

; Serial monitor speed
monitor_speed = 115200
; Keep CLI prompt stable in interactive mode (the `time` filter can break prompt alignment).
monitor_filters = esp32_exception_decoder

; ── AtomClaw (8MB Flash / ESP32-S3 / Discord + Cloudflare) ─

[env:atomclaw]
extends = env:base

; Board: AtomS3R (ESP32-S3, 8MB Flash, 8MB PSRAM)
; Use a generic ESP32-S3 board def; override flash size below
board = esp32-s3-devkitc-1

; 8MB Flash
board_upload.flash_size = 8MB
board_build.flash_size  = 8MB
board_build.flash_mode  = qio
board_build.flash_freq  = 80m

; Custom partition table (AtomClaw, no OTA)
board_build.partitions = partitions_atomclaw.csv

; sdkconfig: base defaults + AtomClaw overrides (paths resolved in CMakeLists.txt)
board_build.cmake_extra_args = -DBUILD_ATOMCLAW=1 -DBUILD_ATOMCLAW_DIAGCFG=1
board_build.sdkconfig = sdkconfig.atomclaw_diagcfg

; Enable AtomClaw variant via Kconfig
build_flags =
    ${env:base.build_flags}
    -DCONFIG_DEVICE_ATOMCLAW=1

; AtomClaw secrets (copy from template and fill in):
;   main/atom_secrets.h
; Required keys:
;   ATOM_SECRET_WIFI_SSID / ATOM_SECRET_WIFI_PASS
;   ATOM_SECRET_API_KEY (Anthropic or OpenAI)
;   ATOM_SECRET_DISCORD_APP_ID
;   ATOM_SECRET_DISCORD_PUBLIC_KEY
;   ATOM_SECRET_CF_WORKER_URL

; Upload settings for AtomS3R (USB)
upload_protocol = esptool
upload_speed    = 921600
; Uncomment if using specific port:
; upload_port = /dev/ttyACM0

; ── AtomClaw + WiFiDiag sdkconfig (A/B diagnosis) ────────────
[env:atomclaw_diagcfg]
; Backward-compatible alias: same settings as env:atomclaw.
extends = env:atomclaw

; ── MimiClaw (16MB Flash / ESP32-S3 / Telegram + WebSocket) ─

[env:mimiclaw]
extends = env:base

board = esp32-s3-devkitc-1

board_upload.flash_size = 16MB
board_build.flash_size  = 16MB
board_build.flash_mode  = qio
board_build.flash_freq  = 80m

; Default partition table (MimiClaw, dual OTA)
board_build.partitions = partitions.csv

board_build.cmake_extra_args = -DBUILD_MIMICLAW=1

build_flags =
    ${env:base.build_flags}
    -DCONFIG_DEVICE_MIMICLAW=1

; MimiClaw secrets:
;   main/mimi_secrets.h
; Required keys:
;   MIMI_SECRET_WIFI_SSID / MIMI_SECRET_WIFI_PASS
;   MIMI_SECRET_API_KEY
;   MIMI_SECRET_TG_TOKEN

upload_protocol = esptool
upload_speed    = 921600

; ── WiFi diagnostics (minimal firmware) ───────────────────────

[env:wifi_diag]
extends = env:base

board = esp32-s3-devkitc-1
board_upload.flash_size = 8MB
board_build.flash_size  = 8MB
board_build.flash_mode  = qio
board_build.flash_freq  = 80m

board_build.cmake_extra_args = -DBUILD_WIFI_DIAG=1

upload_protocol = esptool
upload_speed    = 921600
